<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Olivia Sims — School Task Calendar</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  /* THEME */
  :root{
    --pink:#f7dbe4;       /* soft panel pink */
    --pink-2:#fbe9ef;     /* lighter fill */
    --ink:#222;
    --muted:#8b6b74;
    --line:#d7c7cc;
    --accent:#d93a3a;     /* cute red accent */
    --bg:#ffffff;
    --ok:#58b869; --warn:#e7a23b; --bad:#e05555;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink); background:#fff;
    font-family:Poppins, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  /* PASSWORD LOCK */
  .lock{position:fixed; inset:0; display:grid; place-items:center;
        background:linear-gradient(135deg,#fff, #ffeef4 70%); z-index:50; padding:20px;}
  .lock-card{background:#fff; width:min(520px, 100%); border-radius:20px; padding:22px;
             box-shadow:0 10px 30px rgba(0,0,0,.1); text-align:center;}
  .lock h2{margin:0 0 6px; font-family:"Playfair Display", serif; color:var(--accent);}
  .lock p{margin:0 0 12px; color:var(--muted)}
  .lock input{width:100%; padding:12px 14px; border:1px solid var(--line); border-radius:12px; font-size:1rem}
  .lock .actions{margin-top:10px}
  .btn{display:inline-flex; align-items:center; justify-content:center; gap:6px;
       padding:10px 14px; min-height:44px; border-radius:12px; border:1px solid var(--line);
       background:#fff; color:var(--ink); cursor:pointer; font-weight:700}
  .btn.primary{background:var(--accent); color:#fff; border:none}
  .btn.ghost{background:#fff; border-color:var(--line)}
  .shake{animation:shake .35s ease}
  @keyframes shake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}

  /* SHELL */
  .shell{max-width:1200px; margin:0 auto; padding:18px 16px 40px}
  .grid{
    display:grid; grid-template-columns: 1fr 280px; gap:24px;
  }

  /* HEADER like the reference */
  .cal-header{
    display:grid; grid-template-columns:44px 1fr 44px; align-items:center; margin-bottom:8px;
  }
  .nav-btn{border:none;background:none; cursor:pointer; width:44px;height:44px; border-radius:50%;
           color:var(--accent); font-size:1.6rem}
  .nav-btn:hover{background:#fde3e8}
  .title{
    text-align:center; line-height:1;
    font-family:"Playfair Display", serif; font-weight:700; letter-spacing:0.3px;
  }
  .title .month{font-size:52px; color:#111}
  .title .year{font-size:52px; color:var(--pink); font-weight:700; margin-left:10px}

  /* VERSE BAR */
  .verse{
    border:1px solid var(--line); border-radius:14px; padding:12px; margin:10px 0 16px;
    background:var(--pink-2);
  }
  .verse-ref{font-weight:700; color:var(--accent); margin-bottom:4px}
  .verse-text{font-style:italic}
  .verse .actions{display:flex; gap:8px; justify-content:flex-end; margin-top:8px}

  /* CALENDAR GRID — Monday start, thin borders */
  .calendar{
    border:1px solid var(--ink); border-radius:8px; overflow:hidden; background:#fff;
  }
  .weekday-row, .days{display:grid; grid-template-columns: repeat(7, 1fr)}
  .weekday-row div{
    font-weight:600; text-transform:uppercase; font-size:.82rem; color:#333;
    border-bottom:1px solid var(--ink); padding:10px; letter-spacing:.04em; text-align:center;
  }
  .day-cell{
    position:relative; min-height:92px; padding:10px; border-right:1px solid var(--ink); border-bottom:1px solid var(--ink);
    cursor:pointer; user-select:none; background:#fff;
  }
  .day-cell:nth-child(7n){border-right:none}
  .days:last-child .day-cell{ /* keep last row border-bottom; overridden by container */ }
  .date-num{font-size:.95rem; font-weight:700}
  .task-dot{position:absolute; top:8px; right:8px; width:6px; height:6px; background:var(--accent); border-radius:50%}
  .today{outline:2px solid var(--accent); outline-offset:-2px; background:#fff}

  /* RIGHT SIDEBAR: Notes & Birthdays (always visible) */
  .side-card{
    background:var(--pink); padding:12px; border-radius:8px; margin-bottom:16px; border:1px solid var(--line)
  }
  .side-title{font-weight:700; text-transform:uppercase; letter-spacing:.08em; text-align:center; color:#6a3e49; margin:6px 0 10px}
  .side-textarea{width:100%; min-height:180px; border:1px solid var(--line); border-radius:10px; padding:10px; background:#fff}

  /* ACCORDIONS (collapsible bars) */
  .accordion{margin-top:18px}
  details{
    border:1px solid var(--line); border-radius:10px; background:#fff; overflow:hidden; margin-bottom:10px;
  }
  summary{
    list-style:none; cursor:pointer; padding:12px 14px; font-weight:700; background:#fff;
    display:flex; justify-content:space-between; align-items:center;
  }
  summary::marker{display:none}
  .acc-body{padding:12px 14px; background:#fff}
  .muted{color:var(--muted)}
  .badge{padding:4px 8px; border-radius:8px; background:#f2f2f2; margin-right:6px; font-size:.85rem}
  .dot{display:inline-block; width:10px; height:10px; border-radius:50%; margin-left:6px}
  .low{background:var(--ok)} .medium{background:var(--warn)} .high{background:var(--bad)}
  .delete-btn{border:none;background:var(--accent); color:#fff; padding:6px 10px; border-radius:8px; cursor:pointer}
  .bulk-btn{display:inline-flex; align-items:center; gap:6px}

  /* MODALS (Bulk Upload + Day Tasks) */
  .backdrop{position:fixed; inset:0; background:rgba(0,0,0,.28); display:none; align-items:center; justify-content:center; padding:16px; z-index:40}
  .modal{background:#fff; width:min(720px, 100%); border-radius:14px; padding:14px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .modal header{display:flex; justify-content:space-between; align-items:center}
  .modal h3{margin:0; color:var(--accent); font-family:"Playfair Display", serif}
  .modal textarea{width:100%; min-height:180px; border:1px solid var(--line); border-radius:10px; padding:10px; background:#fff}
  .modal .actions{display:flex; gap:8px; justify-content:flex-end; margin-top:10px}

  /* RESPONSIVE */
  @media (max-width: 960px){
    .grid{grid-template-columns:1fr}
    .side-card{order:2}
  }
</style>
</head>
<body>
  <!-- PASSWORD -->
  <div class="lock" id="lockScreen" role="dialog" aria-modal="true">
    <div class="lock-card" id="lockCard">
      <h2>Olivia Sims — Secure Calendar</h2>
      <p>Enter your password to access your calendar.</p>
      <input id="lockInput" type="password" placeholder="Password" autocomplete="current-password">
      <div class="actions"><button class="btn primary" id="unlockBtn">Unlock</button></div>
    </div>
  </div>

  <!-- APP -->
  <main class="shell" id="appRoot" hidden>
    <div class="grid">
      <!-- LEFT: Calendar + Verse -->
      <div>
        <div class="cal-header">
          <button class="nav-btn" id="prevMonth" aria-label="Previous month">⟨</button>
          <div class="title"><span class="month" id="monthName">September</span> <span class="year" id="yearNum">2025</span></div>
          <button class="nav-btn" id="nextMonth" aria-label="Next month">⟩</button>
        </div>

        <!-- Verse bar -->
        <section class="verse">
          <div class="verse-ref" id="verseRef">Bible Verse</div>
          <div class="verse-text" id="verseText">Loading…</div>
          <div class="actions">
            <button class="btn ghost" id="pinVerseBtn">Pin Verse</button>
            <button class="btn ghost" id="newVerseBtn" title="Shuffle today’s verse">New Verse</button>
            <button class="btn ghost bulk-btn" id="openBulkFromCalendar">Bulk Upload</button>
          </div>
        </section>

        <!-- Calendar grid (Monday → Sunday) -->
        <section class="calendar" id="calendar">
          <div class="weekday-row" id="weekdayRow"></div>
          <div class="days" id="days"></div>
        </section>

        <!-- ACCORDIONS -->
        <section class="accordion">
          <!-- Task Manager -->
          <details id="accTasks" open>
            <summary>Task Manager<span class="muted"> (add, import, complete)</span></summary>
            <div class="acc-body">
              <div class="form" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center">
                <input id="taskTitle" placeholder="Task title" style="flex:1; min-width:200px; padding:10px; border:1px solid var(--line); border-radius:10px">
                <input id="taskDate" type="date" style="padding:10px; border:1px solid var(--line); border-radius:10px">
                <select id="taskCategory" style="padding:10px; border:1px solid var(--line); border-radius:10px">
                  <option>Homework</option><option>Project</option><option>Exam</option><option>Reminder</option>
                </select>
                <select id="taskPriority" style="padding:10px; border:1px solid var(--line); border-radius:10px">
                  <option>low</option><option>medium</option><option>high</option>
                </select>
                <button class="btn primary" id="addTask">Add Task</button>
                <button class="btn ghost bulk-btn" id="openBulk">Bulk Upload</button>
              </div>
              <ul id="taskList" style="list-style:none; padding:0; margin-top:12px"></ul>
              <button class="btn primary" id="deleteCompleted" style="width:100%; margin-top:10px">Delete All Completed Tasks</button>
            </div>
          </details>

          <!-- Weekly View -->
          <details id="accWeekly">
            <summary>Weekly View<span class="muted"> (navigate weeks)</span></summary>
            <div class="acc-body">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px">
                <button class="btn ghost" id="prevWeek">Prev Week</button>
                <div id="weekTitle" style="font-weight:700; color:var(--accent)">This Week</div>
                <button class="btn ghost" id="nextWeek">Next Week</button>
              </div>
              <div id="weeklyContainer"></div>
              <button class="btn primary" id="deleteCompletedWeekly" style="width:100%; margin-top:10px">Delete All Completed Tasks</button>
            </div>
          </details>

          <!-- Pinned Verses -->
          <details id="accVerses">
            <summary>Pinned Verses</summary>
            <div class="acc-body">
              <div id="pinnedList"></div>
              <button class="btn primary" id="clearPinned" style="width:100%; margin-top:10px">Clear All Pinned Verses</button>
            </div>
          </details>
        </section>
      </div>

      <!-- RIGHT: Notes & Birthdays (always visible) -->
      <aside>
        <div class="side-card">
          <div class="side-title">Notes</div>
          <textarea class="side-textarea" id="notesBox" placeholder="Write notes…"></textarea>
        </div>
        <div class="side-card">
          <div class="side-title">Birthdays</div>
          <textarea class="side-textarea" id="bdayBox" placeholder="Names & dates…"></textarea>
        </div>
      </aside>
    </div>
  </main>

  <!-- BULK UPLOAD MODAL -->
  <div class="backdrop" id="bulkModal" role="dialog" aria-modal="true">
    <div class="modal">
      <header><h3>Bulk Upload Tasks</h3><button class="btn" id="closeBulk">Close</button></header>
      <p class="muted" style="margin:6px 0 8px">Paste one task per line: <code>Title,YYYY-MM-DD,Category,Priority</code></p>
      <textarea id="bulkInput" placeholder="Essay,2025-11-02,Project,low&#10;Math Quiz,2025-11-05,Exam,high"></textarea>
      <div id="bulkErrors" class="muted" aria-live="polite" style="margin-top:6px"></div>
      <div class="actions">
        <button class="btn" id="bulkClear">Clear</button>
        <button class="btn primary" id="bulkImport">Import Tasks</button>
      </div>
    </div>
  </div>

  <!-- DAY TASKS MODAL -->
  <div class="backdrop" id="dayModal" role="dialog" aria-modal="true">
    <div class="modal">
      <header><h3 id="dayTitle">Tasks</h3><button class="btn" id="closeDay">Close</button></header>
      <div id="dayList" style="margin-top:8px"></div>
      <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap">
        <input id="dayNewTitle" placeholder="New task title" style="flex:1; min-width:220px; padding:10px; border:1px solid var(--line); border-radius:10px">
        <select id="dayNewCat" style="padding:10px; border:1px solid var(--line); border-radius:10px">
          <option>Homework</option><option>Project</option><option>Exam</option><option>Reminder</option>
        </select>
        <select id="dayNewPri" style="padding:10px; border:1px solid var(--line); border-radius:10px">
          <option>low</option><option>medium</option><option>high</option>
        </select>
        <button class="btn primary" id="dayAddBtn">Add</button>
      </div>
    </div>
  </div>

<script>
(function(){
  /* ===== Password Gate ===== */
  const PASSWORD='Moana0121';
  const lock=document.getElementById('lockScreen');
  const lockCard=document.getElementById('lockCard');
  const lockInput=document.getElementById('lockInput');
  const unlockBtn=document.getElementById('unlockBtn');
  const appRoot=document.getElementById('appRoot');

  function unlock(){
    const ok=lockInput.value===PASSWORD;
    if(ok){ lock.style.display='none'; appRoot.hidden=false; try{localStorage.setItem('olivia_authed','1');}catch{} initApp(); }
    else { lockCard.classList.remove('shake'); void lockCard.offsetWidth; lockCard.classList.add('shake'); lockInput.value=''; lockInput.focus(); }
  }
  unlockBtn.addEventListener('click', unlock);
  lockInput.addEventListener('keydown', e=>{ if(e.key==='Enter') unlock(); });
  try{ if(localStorage.getItem('olivia_authed')==='1'){ lock.style.display='none'; appRoot.hidden=false; } }catch{}

  /* ===== App ===== */
  function initApp(){
    // Elements
    const monthName=document.getElementById('monthName');
    const yearNum=document.getElementById('yearNum');
    const prevMonth=document.getElementById('prevMonth');
    const nextMonth=document.getElementById('nextMonth');
    const weekdayRow=document.getElementById('weekdayRow');
    const daysEl=document.getElementById('days');

    const taskTitle=document.getElementById('taskTitle');
    const taskDate=document.getElementById('taskDate');
    const taskCategory=document.getElementById('taskCategory');
    const taskPriority=document.getElementById('taskPriority');
    const addTaskBtn=document.getElementById('addTask');
    const taskList=document.getElementById('taskList');

    const prevWeek=document.getElementById('prevWeek');
    const nextWeek=document.getElementById('nextWeek');
    const weekTitle=document.getElementById('weekTitle');
    const weeklyContainer=document.getElementById('weeklyContainer');

    // Bulk modal
    const bulkModal=document.getElementById('bulkModal');
    const openBulk=document.getElementById('openBulk');
    const openBulkFromCalendar=document.getElementById('openBulkFromCalendar');
    const closeBulk=document.getElementById('closeBulk');
    const bulkInput=document.getElementById('bulkInput');
    const bulkImport=document.getElementById('bulkImport');
    const bulkErrors=document.getElementById('bulkErrors');
    const bulkClear=document.getElementById('bulkClear');

    // Day modal
    const dayModal=document.getElementById('dayModal');
    const dayTitle=document.getElementById('dayTitle');
    const dayList=document.getElementById('dayList');
    const closeDay=document.getElementById('closeDay');
    const dayNewTitle=document.getElementById('dayNewTitle');
    const dayNewCat=document.getElementById('dayNewCat');
    const dayNewPri=document.getElementById('dayNewPri');
    const dayAddBtn=document.getElementById('dayAddBtn');

    // Verse
    const verseRefEl=document.getElementById('verseRef');
    const verseTextEl=document.getElementById('verseText');
    const pinVerseBtn=document.getElementById('pinVerseBtn');
    const newVerseBtn=document.getElementById('newVerseBtn');

    // Sidebar notes/bdays
    const notesBox=document.getElementById('notesBox');
    const bdayBox=document.getElementById('bdayBox');

    // Storage keys
    const TASKS_KEY='schoolTasks_OliviaSims';
    const NOTES_KEY='notes_Olivia';
    const BDAY_KEY='birthdays_Olivia';
    const PIN_KEY='pinned_verses_Olivia';
    const LAST_DAY_KEY='verse_last_day_Olivia';
    const LAST_VAL_KEY='verse_value_Olivia';

    // Load notes/birthdays
    try{ notesBox.value = localStorage.getItem(NOTES_KEY)||''; }catch{}
    try{ bdayBox.value = localStorage.getItem(BDAY_KEY)||''; }catch{}
    notesBox.oninput = ()=> localStorage.setItem(NOTES_KEY, notesBox.value);
    bdayBox.oninput = ()=> localStorage.setItem(BDAY_KEY, bdayBox.value);

    let tasks=[];
    try{ tasks=JSON.parse(localStorage.getItem(TASKS_KEY)||'[]'); }catch{ tasks=[]; }
    const save=()=> localStorage.setItem(TASKS_KEY, JSON.stringify(tasks));

    // Helpers
    const fmt=(d,o)=>new Intl.DateTimeFormat('en-US',o).format(d);
    const ymd=d=> d.toISOString().slice(0,10);
    const parseYMD=s=> /^\d{4}-\d{2}-\d{2}$/.test(s) ? new Date(s+'T00:00:00') : null;
    const esc=s=> s.replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]) );

    // Calendar state (Monday start)
    let current = new Date(); current.setDate(1);

    function renderHeader(){
      monthName.textContent = fmt(current, {month:'long'});
      yearNum.textContent = fmt(current, {year:'numeric'});
    }
    function renderWeekdays(){
      const names = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
      weekdayRow.innerHTML = names.map(n=>`<div>${n.toUpperCase()}</div>`).join('');
    }
    function startMonday(date){
      const d = new Date(date.getFullYear(), date.getMonth(), 1);
      let day = d.getDay(); // 0 Sun..6 Sat
      day = (day === 0 ? 7 : day); // make Sunday 7
      d.setDate(1 - (day-1));
      return d;
    }
    function renderGrid(){
      const first = startMonday(current);
      daysEl.innerHTML = '';
      for(let i=0;i<42;i++){
        const day = new Date(first); day.setDate(first.getDate()+i);
        const cell = document.createElement('div'); cell.className='day-cell';
        const inMonth = (day.getMonth() === current.getMonth());
        if(!inMonth){ cell.style.background = '#fafafa'; cell.style.color='#999'; }
        const label = document.createElement('div'); label.className='date-num'; label.textContent = String(day.getDate());
        cell.appendChild(label);

        const ds = ymd(day);
        if(ymd(new Date())===ds && inMonth) cell.classList.add('today');
        if(tasks.some(t=>t.date===ds)){ const dot=document.createElement('span'); dot.className='task-dot'; cell.appendChild(dot); }

        cell.addEventListener('click', ()=> openDayModal(ds, day));
        daysEl.appendChild(cell);
      }
    }
    function renderCalendar(){ renderHeader(); renderWeekdays(); renderGrid(); }

    prevMonth.onclick = ()=>{ current.setMonth(current.getMonth()-1); renderCalendar(); };
    nextMonth.onclick = ()=>{ current.setMonth(current.getMonth()+1); renderCalendar(); };

    // Quick add (Task Manager)
    addTaskBtn.onclick = ()=>{
      const title=(taskTitle.value||'').trim();
      const date=taskDate.value;
      if(!title || !date){ alert('Please enter Title and Date.'); return; }
      if(!parseYMD(date)){ alert('Use a valid date (YYYY-MM-DD).'); return; }
      tasks.push({title, date, category:taskCategory.value, priority:taskPriority.value, done:false});
      save(); taskTitle.value=''; taskDate.value=''; renderTasks(); renderCalendar(); renderWeekly();
    };

    function renderTasks(){
      taskList.innerHTML='';
      if(!tasks.length){ taskList.innerHTML='<li class="muted">No tasks</li>'; return; }
      const sorted=[...tasks].sort((a,b)=> a.date.localeCompare(b.date));
      for(const t of sorted){
        const li=document.createElement('li');
        li.style.display='flex'; li.style.justifyContent='space-between'; li.style.alignItems='center'; li.style.gap='8px';
        li.style.padding='10px'; li.style.border='1px solid var(--line)'; li.style.borderRadius='10px'; li.style.margin='6px 0';
        li.className = t.done ? 'muted' : '';
        li.innerHTML = `<div><span class="badge">${esc(t.category)}</span><strong>${esc(t.title)}</strong> (${t.date}) <span class="dot ${t.priority}"></span></div>
                        <div><input type="checkbox" ${t.done?'checked':''} title="Done">
                        <button class="delete-btn">Delete</button></div>`;
        li.querySelector('input').onchange = ()=>{ t.done=!t.done; save(); renderTasks(); renderCalendar(); renderWeekly(); };
        li.querySelector('.delete-btn').onclick = ()=>{ if(confirm('Delete this task?')){ tasks = tasks.filter(x=>x!==t); save(); renderTasks(); renderCalendar(); renderWeekly(); } };
        taskList.appendChild(li);
      }
    }

    // Weekly view
    function startOfWeek(d){
      const tmp=new Date(d.getFullYear(), d.getMonth(), d.getDate());
      let day = tmp.getDay(); if(day===0) day=7; // Sun->7
      tmp.setDate(tmp.getDate() - (day-1));
      tmp.setHours(0,0,0,0);
      return tmp;
    }
    let weekAnchor = startOfWeek(new Date());
    function renderWeekly(){
      weeklyContainer.innerHTML='';
      const start = new Date(weekAnchor);
      const end = new Date(start); end.setDate(end.getDate()+6);
      weekTitle.textContent = `${fmt(start,{month:'short',day:'numeric'})} – ${fmt(end,{month:'short',day:'numeric',year:'numeric'})}`;
      for(let i=0;i<7;i++){
        const d=new Date(start); d.setDate(start.getDate()+i);
        const ds=ymd(d);
        const card=document.createElement('div');
        card.style.border='1px solid var(--line)'; card.style.borderRadius='10px'; card.style.padding='10px'; card.style.margin='8px 0';
        const h=document.createElement('div'); h.style.color='var(--accent)'; h.style.fontWeight='700';
        h.textContent = d.toLocaleDateString('en-US',{weekday:'long', month:'short', day:'numeric'});
        card.appendChild(h);
        const list = tasks.filter(t=>t.date===ds).sort((a,b)=> (a.priority>b.priority?-1:1));
        if(!list.length){ const m=document.createElement('div'); m.className='muted'; m.textContent='No tasks'; card.appendChild(m); }
        else{
          for(const t of list){
            const row=document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.gap='8px'; row.style.margin='6px 0';
            row.innerHTML = `<div><span class="badge">${esc(t.category)}</span><strong>${esc(t.title)}</strong> <span class="dot ${t.priority}"></span></div>
                             <div><input type="checkbox" ${t.done?'checked':''}><button class="delete-btn">Delete</button></div>`;
            row.querySelector('input').onchange=()=>{ t.done=!t.done; save(); renderWeekly(); renderTasks(); renderCalendar(); };
            row.querySelector('.delete-btn').onclick=()=>{ if(confirm('Delete this task?')){ tasks = tasks.filter(x=>x!==t); save(); renderWeekly(); renderTasks(); renderCalendar(); } };
            card.appendChild(row);
          }
        }
        weeklyContainer.appendChild(card);
      }
    }
    prevWeek.onclick=()=>{ weekAnchor.setDate(weekAnchor.getDate()-7); renderWeekly(); };
    nextWeek.onclick=()=>{ weekAnchor.setDate(weekAnchor.getDate()+7); renderWeekly(); };

    // Delete completed buttons
    document.getElementById('deleteCompleted').onclick=()=>{ if(confirm('Delete all completed tasks?')){ tasks = tasks.filter(t=>!t.done); save(); renderTasks(); renderCalendar(); renderWeekly(); } };
    document.getElementById('deleteCompletedWeekly').onclick=()=>{ if(confirm('Delete all completed tasks?')){ tasks = tasks.filter(t=>!t.done); save(); renderTasks(); renderCalendar(); renderWeekly(); } };

    // Bulk modal (open from both places)
    function openBulkModal(){ bulkModal.style.display='flex'; bulkErrors.textContent=''; bulkInput.focus(); }
    openBulk.onclick=openBulkModal; openBulkFromCalendar.onclick=openBulkModal;
    closeBulk.onclick=()=> bulkModal.style.display='none';
    bulkClear.onclick=()=>{ bulkInput.value=''; bulkErrors.textContent=''; };
    bulkImport.onclick=()=>{
      const CATS=new Set(['Homework','Project','Exam','Reminder']);
      const PRIS=new Set(['low','medium','high']);
      const lines=bulkInput.value.split(/\n+/).map(s=>s.trim()).filter(Boolean);
      if(!lines.length){ bulkErrors.textContent='Nothing to import.'; return; }
      let ok=0,bad=0;
      for(const line of lines){
        const parts=line.split(',').map(x=>x.trim());
        if(parts.length<2){ bad++; continue; }
        let [title,date,cat='Homework',pri='medium']=parts;
        if(!title || !/^\d{4}-\d{2}-\d{2}$/.test(date)){ bad++; continue; }
        if(!CATS.has(cat)) cat='Homework';
        if(!PRIS.has(pri)) pri='medium';
        tasks.push({title, date, category:cat, priority:pri, done:false}); ok++;
      }
      save(); renderTasks(); renderCalendar(); renderWeekly();
      bulkErrors.textContent = `Imported ${ok}. ${bad? bad+' skipped.':''}`;
      if(ok && !bad){ bulkModal.style.display='none'; bulkInput.value=''; }
    };

    /* ==== DAY MODAL (click date to view tasks) ==== */
    let dayOpenDate = null;
    function openDayModal(dateStr, dateObj){
      dayOpenDate = dateStr;
      dayTitle.textContent = `Tasks — ${dateObj.toLocaleDateString('en-US',{weekday:'long', month:'long', day:'numeric', year:'numeric'})}`;
      renderDayList();
      dayModal.style.display='flex';
      // Prefill add row with category/priority defaults
      dayNewTitle.value='';
      dayNewCat.value='Homework';
      dayNewPri.value='medium';
    }
    function renderDayList(){
      const list = tasks.filter(t=>t.date===dayOpenDate).sort((a,b)=> (a.priority>b.priority?-1:1));
      dayList.innerHTML='';
      if(!list.length){ dayList.innerHTML = '<div class="muted">No tasks for this day.</div>'; return; }
      for(const t of list){
        const row=document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.gap='8px'; row.style.padding='6px 0';
        row.innerHTML = `<div><span class="badge">${esc(t.category)}</span><strong>${esc(t.title)}</strong> <span class="dot ${t.priority}"></span></div>
                         <div><input type="checkbox" ${t.done?'checked':''}><button class="delete-btn">Delete</button></div>`;
        row.querySelector('input').onchange=()=>{ t.done=!t.done; save(); renderDayList(); renderTasks(); renderCalendar(); renderWeekly(); };
        row.querySelector('.delete-btn').onclick=()=>{ if(confirm('Delete this task?')){ tasks = tasks.filter(x=>x!==t); save(); renderDayList(); renderTasks(); renderCalendar(); renderWeekly(); } };
        dayList.appendChild(row);
      }
    }
    dayAddBtn.onclick = ()=>{
      const title=(dayNewTitle.value||'').trim();
      if(!title){ alert('Enter a task title.'); return; }
      tasks.push({title, date:dayOpenDate, category:dayNewCat.value, priority:dayNewPri.value, done:false});
      save(); dayNewTitle.value=''; renderDayList(); renderTasks(); renderCalendar(); renderWeekly();
    };
    closeDay.onclick=()=>{ dayModal.style.display='none'; };

    /* ==== Live Bible Verse (with fallbacks) ==== */
    const LOCAL_VERSES=[
      {ref:'John 1:1',text:'In the beginning was the Word, and the Word was with God, and the Word was God.'},
      {ref:'John 3:16',text:'For God so loved the world, that he gave his only begotten Son…'},
      {ref:'John 8:12',text:'I am the light of the world: he that followeth me shall not walk in darkness…'},
      {ref:'John 14:6',text:'I am the way, the truth, and the life…'},
      {ref:'John 14:27',text:'Peace I leave with you, my peace I give unto you…'},
      {ref:'John 15:5',text:'I am the vine, ye are the branches…'},
      {ref:'John 16:33',text:'Be of good cheer; I have overcome the world.'},
      {ref:'John 20:31',text:'These are written, that ye might believe…'}
    ];
    async function fetchRandomVerse(){
      try{
        const r=await fetch('https://beta.ourmanna.com/api/v1/get/?format=json&order=random',{cache:'no-store'});
        if(r.ok){ const j=await r.json(); const text=j?.verse?.details?.text||j?.verse?.details?.verse; const ref=j?.verse?.details?.reference||'Bible Verse'; if(text) return {ref,text}; }
      }catch{}
      try{
        const r=await fetch('https://labs.bible.org/api/?passage=random&type=json',{cache:'no-store'});
        if(r.ok){ const j=await r.json(); if(Array.isArray(j)&&j.length){ const v=j[0]; return {ref:`${v.bookname} ${v.chapter}:${v.verse}`, text:v.text}; } }
      }catch{}
      return LOCAL_VERSES[Math.floor(Math.random()*LOCAL_VERSES.length)];
    }
    function setVerse(v){ verseRefEl.textContent=v.ref||'Bible Verse'; verseTextEl.textContent=v.text||''; currentVerse=v; }
    async function loadVerse(force=false){
      const today=new Date().toISOString().slice(0,10);
      if(!force && localStorage.getItem(LAST_DAY_KEY)===today){
        try{ const v=JSON.parse(localStorage.getItem(LAST_VAL_KEY)||'null'); if(v && v.text){ setVerse(v); return; } }catch{}
      }
      const v=await fetchRandomVerse();
      setVerse(v);
      localStorage.setItem(LAST_DAY_KEY, today);
      localStorage.setItem(LAST_VAL_KEY, JSON.stringify(v));
    }
    let currentVerse=null;
    newVerseBtn.onclick=()=> loadVerse(true);

    // Pinned verses
    const pinnedList=document.getElementById('pinnedList');
    const clearPinned=document.getElementById('clearPinned');
    function getPinned(){ try{const p=JSON.parse(localStorage.getItem(PIN_KEY)||'[]'); return Array.isArray(p)?p:[];}catch{return[];} }
    function setPinned(a){ localStorage.setItem(PIN_KEY, JSON.stringify(a)); renderPinned(); }
    function renderPinned(){
      const pins=getPinned(); pinnedList.innerHTML='';
      if(!pins.length){ pinnedList.innerHTML='<div class="muted">No pinned verses</div>'; return; }
      for(const p of pins){
        const card=document.createElement('div'); card.className='verse';
        card.innerHTML=`<div class="verse-ref">${esc(p.ref)}</div><div class="verse-text">${esc(p.text)}</div>`;
        const actions=document.createElement('div'); actions.className='actions';
        const del=document.createElement('button'); del.className='btn primary'; del.textContent='Delete';
        del.onclick=()=>{ const next=getPinned().filter(x=>!(x.ref===p.ref && x.text===p.text)); setPinned(next); };
        actions.appendChild(del); card.appendChild(actions); pinnedList.appendChild(card);
      }
    }
    clearPinned.onclick=()=>{ if(confirm('Clear all pinned verses?')) setPinned([]); };
    pinVerseBtn.onclick=()=>{
      if(!currentVerse){ alert('Verse not loaded yet.'); return; }
      const pins=getPinned();
      if(!pins.some(p=>p.ref===currentVerse.ref && p.text===currentVerse.text)){
        pins.unshift({ref:currentVerse.ref, text:currentVerse.text, ts:Date.now()}); setPinned(pins); alert('Verse pinned.');
      } else alert('Already pinned.');
    };

    // INIT
    function renderAll(){ renderCalendar(); renderTasks(); renderWeekly(); renderPinned(); }
    renderAll(); loadVerse(false);

    // Key navigation
    window.addEventListener('keydown', (e)=>{
      if(e.key==='ArrowLeft') prevMonth.click();
      if(e.key==='ArrowRight') nextMonth.click();
    });
  }

  if(!appRoot.hidden){ initApp(); }
})();
</script>
</body>
</html>
